# Copilot / AI assistant instructions for this repository

Purpose: give concise, actionable guidance so an AI coding agent can be immediately productive.

- Project type: Next.js (app router) written in TypeScript, running on Next 16 + React 19 with Turbopack enabled. Key entrypoints: `src/app/` and `src/components/`.
- Build / dev commands (use `pnpm`):
  - Install: `pnpm i`
  - Dev: `pnpm dev` (runs `next dev --turbopack -p 2025`)
  - Build: `pnpm build` (runs `next build --turbopack`)
  - Start: `pnpm start`
  - SVG index generator (watches): `pnpm svg` -> runs `scripts/gen-svgs-index.js`

- High-level architecture and where to look:
  - UI / routes: `src/app/` (uses the Next App Router). The homepage lives in `src/app/(home)/page.tsx` and the reusable home cards are under `src/app/(home)/*.tsx` (e.g. `hi-card.tsx`).
  - Global layout & metadata: `src/app/layout.tsx` and `src/layout/`.
  - Components: `src/components/` for site-wide UI pieces.
  - Static/blog content: `public/blogs/` (each blog has a folder with `config.json` and `index.md`).
  - Config: `src/config/site-content.json` controls top-level site settings (title, theme colors, social links).
  - Scripts: `scripts/` contains helper scripts like `gen-svgs-index.js` which generates `src/svgs/index.ts`.

- GitHub integration (important):
  - This project uses a GitHub App and programmatic commits. See `src/lib/github-client.ts` for the exact flow: sign app JWT -> get installation id -> create installation token -> read/put files and batch commits.
  - Sensitive values (private keys, app id, repo owner) are passed via environment variables prefixed `NEXT_PUBLIC_GITHUB_*`. The constants are defined in `src/consts.ts`.
  - Do NOT hardcode or commit private keys. When testing flows that require the GitHub App, run locally with the correct env vars or modify `src/consts.ts` only for temporary local debugging (then revert).

- Patterns and conventions to follow when editing code:
  - Prefer modifying content under `public/blogs/` for content changes. Programmatic changes use services under `src/app/**/services/` (e.g. `src/app/(home)/services/push-site-content.ts`).
  - Look in `src/lib/` for utilities interacting with GitHub, file handling, markdown rendering (`markdown-renderer.ts`), and auth (`auth.ts`).
  - Many UI components are server/client mixed. Check `use client` pragma at the top of files (e.g. `src/lib/github-client.ts` is client-side).
  - SVGs are imported via `@svgr/webpack` and an index is auto-generated by `scripts/gen-svgs-index.js`.

- When making commits programmatically in tests or tasks:
  - Follow the exact sequence in `src/lib/github-client.ts`: signAppJwt -> getInstallationId -> createInstallationToken -> use token for `putFile`, `createTree`, `createCommit`, `updateRef`.
  - Use `readTextFileFromRepo` to read content (it handles decoding). When creating base64 content, prefer `toBase64Utf8` helper patterns.

- Quick examples (where to change things):
  - Update homepage cards: edit `src/app/(home)/hi-card.tsx` or `src/app/(home)/aritcle-card.tsx`.
  - Add a new SVG: put the `.svg` under `src/svgs/` and run `pnpm svg` (watcher regenerates `src/svgs/index.ts`).
  - Change site meta or theme: edit `src/config/site-content.json` (this is read by `src/app/layout.tsx`).

- Testing & debugging notes:
  - App uses Turbopack; if you hit bundler issues, running `pnpm build` replicates production bundling. If Turbopack causes trouble, try plain Next (not part of default scripts here).
  - For GitHub API problems, inspect network calls in the browser and server logs; `src/lib/github-client.ts` returns helpful error messages for non-ok responses.

- Developer expectations for AI edits:
  - Keep changes focused and minimal. When adding features, update `package.json` scripts if needed and include a short one-line change note.
  - If code interacts with GitHub App, include instructions for required env variables and an example `ENV` snippet in the PR description.
  - Preserve existing style and TypeScript types. The repo uses Prettier; run `pnpm format` (script: `format`) on changed files.

- Where to look first for questions:
  - `README.md` — high-level deployment and GitHub App setup steps (useful sample flows for env vars).
  - `src/lib/github-client.ts` — canonical GitHub API helpers and commit flows.
  - `src/consts.ts` and `src/config/site-content.json` — environment / site settings.

If any of these assumptions are incomplete (CI, secrets locations, or special deploy hooks), tell me what to add or correct and I will update this file.
